using CFDomains

function NCARL30(nz, ptop::Float) where Float

    hyai = Float[
        0,
        0,
        0.00397881818935275,
        0.00853108894079924,
        0.0136180268600583,
        0.0191967375576496,
        0.0252212174236774,
        0.0316426791250706,
        0.0427346378564835,
        0.0576589405536652,
        0.0753444507718086,
        0.0946138575673103,
        0.113875567913055,
        0.130248308181763,
        0.14416541159153,
        0.155995160341263,
        0.166050657629967,
        0.17459799349308,
        0.181863352656364,
        0.154586806893349,
        0.131401270627975,
        0.11169321089983,
        0.0949410423636436,
        0.0807014182209969,
        0.0633234828710556,
        0.0458674766123295,
        0.0306691229343414,
        0.0185553170740604,
        0.0101579474285245,
        0.00503169186413288,
        0.00225523952394724,
    ]

    hybi = Float[
        1,
        0.985112190246582,
        0.963559806346893,
        0.938901245594025,
        0.911346435546875,
        0.881127893924713,
        0.848494648933411,
        0.813710987567902,
        0.753628432750702,
        0.672786951065063,
        0.576988518238068,
        0.47261056303978,
        0.368274360895157,
        0.279586911201477,
        0.204201176762581,
        0.140122056007385,
        0.0856537595391273,
        0.0393548272550106,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
    ]

    hyam = Float[
        0,
        0.00198940909467637,
        0.00625495356507599,
        0.0110745579004288,
        0.0164073822088539,
        0.0222089774906635,
        0.028431948274374,
        0.0371886584907771,
        0.0501967892050744,
        0.0665016956627369,
        0.0849791541695594,
        0.104244712740183,
        0.122061938047409,
        0.137206859886647,
        0.150080285966397,
        0.161022908985615,
        0.170324325561524,
        0.178230673074722,
        0.168225079774856,
        0.142994038760662,
        0.121547240763902,
        0.103317126631737,
        0.0878212302923203,
        0.0720124505460262,
        0.0545954797416925,
        0.0382682997733354,
        0.0246122200042009,
        0.0143566322512924,
        0.00759481964632869,
        0.00364346569404006,
    ]

    hybm = Float[
        0.992556095123291,
        0.974335998296737,
        0.951230525970459,
        0.92512384057045,
        0.896237164735794,
        0.864811271429062,
        0.831102818250657,
        0.783669710159302,
        0.713207691907882,
        0.624887734651566,
        0.524799540638924,
        0.420442461967468,
        0.323930636048317,
        0.241894043982029,
        0.172161616384983,
        0.112887907773256,
        0.0625042933970689,
        0.0196774136275053,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
    ]

    P0 = Float(1e5)

    @assert nz==30
#    @info "NCARL30" ptop P0*hyai[end]
    @assert ptop â‰ˆ P0*hyai[end]

    return CFDomains.HybridCoordinate(ptop, P0*hyai, P0*hyam, hybi, hybm)
end

function write_apbp(choices, model)
    # write apbp.txt for DYNAMICO
    open("apbp.txt", "w") do io
        ptop, nz = model.vcoord.ptop, choices.nz
        hya = [ptop*(i/nz) for i in 0:nz]
        hyb = [1-i/nz for i in 0:nz]
        for i in eachindex(hya)
            println(io, hya[i], " ", hyb[i])
        end
    end
end
